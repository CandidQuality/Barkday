<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barkdayâ„¢ â€¢ Dog â†’ Human Years</title>
  <meta name="description" content="Dog-year birthdays: calculate the next one and get a plan for better care." />
  <style>
    :root{ --bg:#0b0c10; --card:#13151a; --text:#e8ecf1; --muted:#9aa4af; --brand:#4aa3ff; --accent:#6ae3b2; --danger:#ff6b6b; --border:#232734; --shadow:0 6px 24px rgba(0,0,0,.35); }
    :root[data-theme="light"]{ --bg:#f7f8fa; --card:#ffffff; --text:#0f172a; --muted:#475569; --brand:#2563eb; --accent:#059669; --danger:#b91c1c; --border:#e2e8f0; --shadow:0 6px 24px rgba(2,6,23,.08); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}

    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .title{display:flex;gap:12px;align-items:center}
    .logoImg{width:48px;height:auto;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.25))}
    .toggle{appearance:none;border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    h1{font-size:24px;margin:0}
    h2{font-size:18px;margin:0 0 8px}
    label{font-weight:600;display:block;margin:14px 0 6px}
    input[type="number"], select, input[type="date"], input[type="text"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg);color:var(--text)}
    input[type="range"]{width:100%}
    .row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    .row > div{flex:1 1 240px;min-width:220px}
    .muted{color:var(--muted);font-size:14px}
    .divider{height:1px;background:var(--border);margin:12px -16px}

    .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
    .pill{border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.05));border-radius:14px;padding:10px 12px}
    .pill h3{margin:0 0 6px;font-size:15px;color:var(--muted);font-weight:600}
    .big{font-size:24px;font-weight:800}
    .headline{font-size:26px;font-weight:900;line-height:1.15;margin:0 0 4px}
    .primary{outline:2px solid var(--brand);}

    .btn{appearance:none;border:1px solid var(--border);background:var(--brand);color:white;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.secondary{background:transparent;color:var(--text)}

    .cardlist{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .gift{border:1px solid var(--border);border-radius:12px;padding:12px}
    .gift h4{margin:0 0 6px}
    .link{background:none;border:0;color:var(--brand);cursor:pointer;text-decoration:underline;padding:0}
    .hero{margin:4px 0 0 60px}
    .warn{background:rgba(255,107,107,.1);border:1px solid var(--danger);color:var(--danger);padding:8px 10px;border-radius:10px;margin:8px 0}

    /* Plan lanes */
    .plan{margin-top:12px}
    .lane{border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.04))}
    .lane h4{margin:0 0 6px;font-size:15px;color:var(--muted)}
    .lane ul{margin:0;padding-left:18px}
    .lane li{margin:4px 0}

    /* Splash */
    .splash{
      position:fixed; inset:0; display:grid; place-items:center;
      background:radial-gradient(1000px 500px at 20% 10%, rgba(255,255,255,.06), transparent),
                 radial-gradient(1000px 500px at 80% 90%, rgba(255,255,255,.05), transparent),
                 var(--bg);
      z-index:9999; transition:opacity .5s ease; opacity:1;
    }
    .splash.hide{ opacity:0; pointer-events:none }
    .splash .logoWrap{width:180px;height:180px;border-radius:20px;display:grid;place-items:center}
    .splash .logoWrap img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 6px 16px rgba(0,0,0,.45))}
  </style>
</head>
<body>
  <!-- SPLASH -->
  <div id="splash" class="splash" aria-hidden="true">
    <div class="logoWrap">
      <img id="logoSplash" alt="Barkday logo" src="" />
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="title">
        <img id="logoHeader" class="logoImg" alt="Barkday logo" src="" />
        <h1>Barkdayâ„¢</h1>
      </div>
      <button id="themeToggle" class="toggle" type="button" aria-label="Toggle theme">ðŸŒ™ Dark</button>
    </header>

    <p id="heroLine" class="muted hero">Letâ€™s find out together what your precious friendâ€™s birthdays are, so we can celebrate every single one.</p>

    <section class="card">
      <h2>Dog â†’ Human Years</h2>
      <p class="muted">Evidence-based calculator using AVMA/AKC milestones (15/9 rule) with a <strong>weight-continuous slope</strong> after year 2. Optional UCSD DNA-methylation curve (â‰¥ 1 yr). <em>Calculate/Reset only â€” no auto-recalc.</em></p>
      <div class="divider"></div>

      <div class="row">
        <div>
          <label for="dogName">Dog name</label>
          <input id="dogName" type="text" placeholder="e.g., Flip" />
        </div>
        <div>
          <label for="dob">Birthdate</label>
          <input id="dob" type="date" />
          <div class="muted">Dog age shown under Results.</div>
        </div>
        <div>
          <label for="adultWeight">Expected adult weight (lb)</label>
          <input id="adultWeight" type="range" min="5" max="200" step="5" value="55" />
          <div class="muted">Aging rate uses <em>5-lb steps</em>. <span id="adultWeightVal">55</span> lb</div>
        </div>
        <div>
          <label for="chewer">Chewer level</label>
          <select id="chewer">
            <option>Gentle</option>
            <option selected>Normal</option>
            <option>Power</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Advanced</label>
          <label class="muted"><input id="showEpigenetic" type="checkbox"/> Show science curve (?) (UCSD DNA-methylation, â‰¥1 yr)</label>
          <label class="muted"><input id="smoothMilestones" type="checkbox" checked/> Use smooth milestones (blend around 12 & 24 months)</label>
        </div>
        <div>
          <label for="breed">Breed (optional)</label>
          <input id="breed" type="text" placeholder="e.g., Australian Shepherd" />
          <div class="muted">Notes only â€” math stays weight-based.</div>
        </div>
        <div>
          <label for="breedGroup">Breed group</label>
          <select id="breedGroup">
            <option>Working / Herding</option>
            <option>Sporting</option>
            <option>Hound</option>
            <option>Terrier</option>
            <option>Toy</option>
            <option>Non-Sporting</option>
            <option>Guardian</option>
            <option>Companion</option>
            <option>Mixed / Other</option>
          </select>
          <div id="breedExamples" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <label class="muted"><input id="ignoreAge" type="checkbox"/> Ignore age filter</label>
        <label class="muted"><input id="ignoreSize" type="checkbox"/> Ignore size filter</label>
        <label class="muted"><input id="ignoreChewer" type="checkbox"/> Ignore chewer filter</label>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="calcBtn" class="btn" type="button">Calculate</button>
        <button id="resetBtn" class="btn secondary" type="button">Reset</button>
        <button id="shareBtn" class="btn secondary" type="button">Share link</button>
      </div>

      <div id="sizeWarn" class="warn" style="display:none"></div>

      <div class="divider"></div>

      <h2>Results</h2>
      <div class="kpi">
        <div class="pill primary">
          <div class="headline" id="nextHeadline">â€”</div>
          <div class="big" id="nextBday">â€”</div>
          <div class="muted" id="nextBdayDelta"></div>
        </div>
        <div class="pill"><h3>Dog age today</h3><div class="big" id="dogAge">â€”</div></div>
        <div class="pill"><h3>Human-years estimate</h3><div class="big" id="humanYears">â€”</div><div class="muted" id="slopeNote"></div></div>
      </div>
      <p id="profileLine" class="muted" style="margin:8px 0 0">â€”</p>
      <div id="breedNotes" class="muted" style="margin:6px 0 0"></div>

      <div class="row" style="margin-top:10px">
        <button id="addCalBtn" class="btn" type="button">Add to calendar (birthday)</button>
        <button id="remindBtn" class="btn secondary" type="button">Add 1-week reminder</button>
        <button id="addYearSeries" class="btn secondary" type="button">Add next 3 dog-year birthdays</button>
      </div>

      <div id="epi" class="muted" style="margin-top:10px"></div>

      <div class="divider"></div>

      <h2 id="nextPlanHeading">Next Birthday Plan</h2>
      <div id="nextPlan" class="plan"></div>

      <div class="divider"></div>

      <h2>Gift ideas</h2>
      <button id="loadGifts" class="btn secondary" type="button">Load gift ideas</button>
      <div id="giftMeta" class="muted" style="margin:8px 0"></div>
      <div id="gifts" class="cardlist"></div>
    </section>
  </div>

  <script>
    // ---- Single base64 logo (256px optimized) reused in both places
    const LOGO_B64 = "data:image/png;base64,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";

    // Theme toggle
    const root = document.documentElement, themeBtn = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('barkday-theme') || 'dark';
    root.setAttribute('data-theme', savedTheme === 'light' ? 'light' : 'dark');
    themeBtn.textContent = savedTheme === 'light' ? 'ðŸŒ™ Dark' : 'â˜€ï¸ Light';
    themeBtn.addEventListener('click', () => {
      const now = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      root.setAttribute('data-theme', now); localStorage.setItem('barkday-theme', now);
      themeBtn.textContent = now === 'light' ? 'ðŸŒ™ Dark' : 'â˜€ï¸ Light';
    });

    // Assign logo to both images
    document.getElementById('logoHeader').src = LOGO_B64;
    document.getElementById('logoSplash').src = LOGO_B64;

    // Splash fade (shows once we assign the image)
    window.addEventListener('load', () => setTimeout(()=>document.getElementById('splash')?.classList.add('hide'), 900));

    // Shortcuts
    const $ = id => document.getElementById(id);
    const els = {
      dogName: $('dogName'), dob: $('dob'), adultWeight: $('adultWeight'), adultWeightVal: $('adultWeightVal'),
      chewer: $('chewer'), showEpi: $('showEpigenetic'), smooth: $('smoothMilestones'), breed: $('breed'), breedGroup: $('breedGroup'),
      ignoreAge: $('ignoreAge'), ignoreSize: $('ignoreSize'), ignoreChewer: $('ignoreChewer'),
      calcBtn: $('calcBtn'), resetBtn: $('resetBtn'), shareBtn: $('shareBtn'), sizeWarn: $('sizeWarn'),
      nextHeadline: $('nextHeadline'), nextBday: $('nextBday'), nextBdayDelta: $('nextBdayDelta'),
      dogAge: $('dogAge'), humanYears: $('humanYears'), slopeNote: $('slopeNote'),
      addCal: $('addCalBtn'), remind: $('remindBtn'), addYearSeries: $('addYearSeries'),
      loadGifts: $('loadGifts'), giftMeta: $('giftMeta'), gifts: $('gifts'), heroLine: $('heroLine'), profileLine: $('profileLine'), breedNotes: $('breedNotes'), epi: $('epi')
    };

    // Personalized hero
    const poss = n => !n ? "your precious friend's" : (/\s*$/.test(n)&&/s$/i.test(n.trim())? n.trim()+"â€™" : n.trim()+"â€™s");
    function renderHero(){ els.heroLine.textContent = `Letâ€™s find out together what ${poss(els.dogName.value)} birthdays are, so we can celebrate every single one.`; }
    els.dogName.addEventListener('input', renderHero); renderHero();

    // Breed examples/notes
    const GROUP_META = {
      'Working / Herding': { desc:'High-drive problem solvers; thrive on jobs.', examples:['Border Collie','Australian Shepherd','German Shepherd','Belgian Malinois','Corgi'] },
      'Sporting': { desc:'Endurance & retrieving; water-confident.', examples:['Labrador','Golden Retriever','Vizsla','GSP','Setter'] },
      'Hound': { desc:'Scent/sight specialists; independent.', examples:['Beagle','Dachshund','Greyhound','Foxhound','Basset'] },
      'Terrier': { desc:'Tenacious hunters; love dig/chase.', examples:['JRT','Westie','Airedale','Border Terrier'] },
      'Toy': { desc:'Small frames; fragile joints.', examples:['Chihuahua','Pomeranian','Yorkie','Maltese','Papillon'] },
      'Non-Sporting': { desc:'Mixed roles; varied needs.', examples:['Bulldog','Dalmatian','Poodle (Std)','Boston Terrier'] },
      'Guardian': { desc:'Large/giant protectors.', examples:['Rottweiler','Mastiff','Great Dane','Anatolian','Kuvasz'] },
      'Companion': { desc:'Human-bonded routines.', examples:['Cavapoo','Cockapoo','Shih Tzu','Havanese'] },
      'Mixed / Other': { desc:'Profile by drive & size.', examples:['Mixed-breed','Rescue','Unknown'] }
    };
    const GROUPS = {
      'Working / Herding':['Daily jobs/puzzles (herding games, scentwork).','Mental as important as physical; enrichment.','Prevent under-stimulation â†’ boredom.'],
      'Sporting':['Structured fetch/dock/field games.','Watch weight; measured meals.'],
      'Hound':['Scent walks on long line; recall with high-value rewards.'],
      'Terrier':['Dig boxes, flirt poles, controlled tug.'],
      'Toy':['Low-impact play; dental care; temperature care.'],
      'Non-Sporting':['Tailor enrichment to individual needs.'],
      'Guardian':['Impulse control & neutrality; joint support.'],
      'Companion':['Reinforce calm independence; routines.'],
      'Mixed / Other':['Profile by observed drive (retrieve, scent, herd).']
    };
    function updateBreedNotes(){
      const name = els.dogName.value || 'your dog';
      const breedTxt = (els.breed.value||'').trim();
      const group = els.breedGroup.value;
      const lb = parseInt(els.adultWeight.value,10) || 55;
      els.profileLine.textContent = `Profile: ${name}${breedTxt ? ' â€” ' + breedTxt : ''} â€¢ Group: ${group} â€¢ Weight: ${lb} lb`;
      const notes = GROUPS[group]||[]; els.breedNotes.innerHTML = notes.map(n=>`â€¢ ${n}`).join(' ');
      const meta = GROUP_META[group]; const bx = $('breedExamples');
      bx.textContent = meta ? `${meta.desc} Examples: ${meta.examples.join(', ')}` : '';
    }
    ['input','change'].forEach(ev=>{
      els.breed.addEventListener(ev, updateBreedNotes);
      els.breedGroup.addEventListener(ev, updateBreedNotes);
      els.dogName.addEventListener(ev, updateBreedNotes);
      els.adultWeight.addEventListener(ev, updateBreedNotes);
    });
    updateBreedNotes();

    // Slider label (5-lb steps)
    els.adultWeight.addEventListener('input', ()=>{ const v=Math.round(parseInt(els.adultWeight.value,10)/5)*5; els.adultWeight.value=v; els.adultWeightVal.textContent=v; });

    // Utils
    const clamp=(n,min,max)=>Math.min(Math.max(n,min),max);
    const daysBetween=(a,b)=>Math.floor((b-a)/(24*60*60*1000));

    // Weightâ†’slope (5â†’~7.2)
    function slopeFromWeight(lb){ const w=clamp(lb,5,200); if(w<=20) return 5; if(w<=50) return 5+(w-20)*(1/30); if(w<=90) return 6+(w-50)*(1/40); return 7+(w-90)*(0.2/110); }
    function smoothBlend(x,c,w){ const t=clamp((x-(c-w/2))/w,0,1); return t*t*(3-2*t); }
    function humanEqYears(tY, lb, smooth){
      const R=slopeFromWeight(lb);
      if(!smooth){ if(tY<=1) return 15*tY; if(tY<=2) return 15+9*(tY-1); return 24+R*(tY-2); }
      const f1=smoothBlend(tY,1,.25), slope12=15+f1*(9-15);
      if(tY<=2){ const a=Math.min(tY,1)*15; const b=tY>1?(tY-1)*slope12:0; return a+b; }
      const f2=smoothBlend(tY,2,.5), post=9+f2*(R-9), upto2=humanEqYears(2,lb,true);
      return upto2+(tY-2)*post;
    }
    function nextDogYearDate(dob, H, lb, smooth){
      const target=Math.floor(H)+1, now=new Date();
      const yearsNow=daysBetween(dob, now)/365.2425;
      let lo=yearsNow, hi=yearsNow+5;
      for(let i=0;i<40;i++){ const mid=(lo+hi)/2; const h=humanEqYears(mid,lb,smooth); if(h>=target) hi=mid; else lo=mid; }
      const t=(lo+hi)/2; return new Date(dob.getTime()+t*365.2425*24*60*60*1000);
    }

    // Confetti
    function confetti(ms=1700){
      const c=document.createElement('canvas'); c.style.position='fixed'; c.style.inset='0'; c.style.pointerEvents='none';
      c.width=innerWidth; c.height=innerHeight; document.body.appendChild(c); const ctx=c.getContext('2d');
      const colors=['#4aa3ff','#6ae3b2','#ffd166','#ff6b6b','#a78bfa']; const N=160;
      const parts=Array.from({length:N},()=>({x:Math.random()*c.width,y:-20-Math.random()*40,vx:(Math.random()-.5)*4,vy:2+Math.random()*3,g:0.05+Math.random()*0.05,s:4+Math.random()*4,c:colors[(Math.random()*colors.length)|0],r:Math.random()*Math.PI}));
      let st=null; (function tick(ts){ if(!st) st=ts; const t=ts-st; ctx.clearRect(0,0,c.width,c.height);
        for(const p of parts){ p.x+=p.vx; p.y+=p.vy; p.vy+=p.g; p.r+=0.05; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r); ctx.fillStyle=p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); ctx.restore(); }
        if(t<ms) requestAnimationFrame(tick); else c.remove();
      })(0);
    }

    // Banded recos (seeded; expand later)
    const AGE_BANDS = [
      { key:'puppy_1_6',min:1,max:6,label:'Puppy I (1â€“6 dog-years)' },
      { key:'puppy_7_10',min:7,max:10,label:'Puppy II (7â€“10 dog-years)' },
      { key:'puppy_11_15',min:11,max:15,label:'Puppy III (11â€“15 dog-years)' },
      { key:'young_16_24',min:16,max:24,label:'Young (16â€“24 dog-years)' },
      { key:'adult_25_60',min:25,max:60,label:'Adult (25â€“60 dog-years)' },
      { key:'senior_61p',min:61,max:999,label:'Senior (61+ dog-years)' }
    ];
    const bandForDY = dy => AGE_BANDS.find(b=>dy>=b.min && dy<=b.max) || AGE_BANDS[AGE_BANDS.length-1];
    const RECO_BANDED = {
      "Working / Herding": {
        puppy_1_6:{lanes:{ training:["Name/marker 1â€“3 min, 3â€“5Ã—/day","Gentle handling (paws/ears/mouth)","Crate = calm naps; short positive entries","Potty schedule after sleep/eat/play"],
                         health:["Puppy vaccine series; deworm","Parasite prevention","Set up x-pen / safe confinement"],
                         nutrition:["Puppy diet; 3â€“4 small meals/day","Weigh weekly; track BCS"],
                         exercise:["Free play on soft surfaces","Short leash intros; sniff & explore","No big jumps; carry stairs if possible"],
                         bonding:["Friendly people/dogs socialization","Groom/brush + treats"],
                         gear:["Light Y-front harness","Snuffle/lick mat; puppy teether"]}},
        puppy_7_10:{lanes:{ training:["Recall on 15â€“30 ft line","Settle on mat (1â€“3 â†’ 5â€“7 min)","Leave-it & polite greetings"],
                            health:["Series continues; spay/neuter timing","Teething: supervised chews"],
                            nutrition:["Maintain puppy diet; growth curve"],
                            exercise:["2â€“3 short sniff-walks (5â€“15 min)","Avoid repetitive fetch/jumps"],
                            bonding:["Puzzle feeders 3â€“4Ã—/week","Easy nosework (3â€“5 hides)"],
                            gear:["Biothane long line; treat pouch","Level-1/2 puzzle; soft tug"]}}
      }
    };
    const RECO = {};

    function planFor(group, dogYears){
      const band = bandForDY(Math.round(dogYears));
      const plan = (RECO_BANDED[group]||{})[band.key];
      if (plan) return { plan, band };
      const g = (RECO[group] || RECO['Mixed / Other'] || {}), keys=Object.keys(g).map(k=>+k).sort((a,b)=>a-b);
      if(!keys.length) return { plan:null, band }; let lo=null, up=null; for(const k of keys){ if(k<=dogYears) lo=k; if(k>=dogYears && up===null) up=k; }
      const chosen=(lo!==null)?lo:up; return { plan:g[chosen]||null, band };
    }
    function renderPlan(group, upcomingDY){
      const box=$('nextPlan'); box.innerHTML=''; const {plan,band}=planFor(group,upcomingDY);
      const head=$('nextPlanHeading'); head.textContent = `Next Birthday Plan â€” ${band?band.label:('turning '+upcomingDY)}`;
      if(!plan){ box.innerHTML='<div class="muted">Recommendations coming soon.</div>'; return; }
      const order=[['training','Training & Enrichment'],['health','Health & Wellness'],['nutrition','Diet & Nutrition'],['exercise','Exercise Needs'],['bonding','Play & Bonding Ideas'],['gear','Helpful Gear (optional)']];
      for(const [k,label] of order){
        const items=(plan.lanes&&plan.lanes[k])?plan.lanes[k]:[]; if(!items.length) continue;
        const d=document.createElement('div'); d.className='lane'; d.innerHTML=`<h4>${label}</h4>`; const ul=document.createElement('ul');
        items.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); }); d.appendChild(ul); box.appendChild(d);
      }
    }

    // Gifts
    const GIFT_FEED_URL = 'https://raw.githubusercontent.com/CandidQuality/dog-birthday-feed/main/dog-gifts.json';
    async function loadGifts(){
      els.gifts.innerHTML=''; els.giftMeta.textContent='Loadingâ€¦';
      try{
        const res = await fetch(GIFT_FEED_URL,{cache:'no-store'}); const items = await res.json();
        const lb = parseInt(els.adultWeight.value,10);
        const bucket = lb<20?'toy':lb<30?'small':lb<50?'medium':lb<90?'large':'giant';
        const dogYears = parseFloat(els.humanYears.textContent);
        const chewer = (els.chewer.value||'').toLowerCase();

        const results = [];
        for(const it of items){
          let ok = true, score = 0;
          const sizes = (Array.isArray(it.sizes)? it.sizes : (it.size? String(it.size).split(/[, \t]+/):[])).map(s=>String(s).toLowerCase());
          const sizeOK = !sizes.length || sizes.includes('any') || sizes.includes(bucket);
          if(!els.ignoreSize.checked && !sizeOK) ok=false; else if(sizeOK) score++;

          const chewTag = (it.chewer? String(it.chewer).toLowerCase() : 'any');
          const chewOK = chewTag==='any' || chewTag===chewer;
          if(!els.ignoreChewer.checked && !chewOK) ok=false; else if(chewOK) score++;

          const minDY = it.minDogYears ?? null, maxDY = it.maxDogYears ?? null;
          let ageOK = true;
          if(!isNaN(dogYears) && !els.ignoreAge.checked){
            if(minDY!=null) ageOK = ageOK && dogYears >= Number(minDY);
            if(maxDY!=null) ageOK = ageOK && dogYears <= Number(maxDY);
            if(minDY==null && maxDY==null && it.tag){
              const t=String(it.tag).toLowerCase();
              if(t.includes('puppy')) ageOK = dogYears<=15;
              else if(t.includes('senior')) ageOK = dogYears>=61;
            }
          }
          if(!els.ignoreAge.checked && !ageOK) ok=false; else if(ageOK) score++;

          if(ok) results.push({it, score, rnd:Math.random()});
        }
        results.sort((a,b)=> (b.score-a.score) || (a.rnd-b.rnd));
        const top = results.slice(0,12).map(r=>r.it);

        const parts=[]; parts.push(`size=${bucket}`); parts.push(`chewer=${chewer||'normal'}`); if(!isNaN(dogYears)) parts.push(`ageâ‰ˆ${dogYears.toFixed(2)} DY`);
        const ignored=[]; if(els.ignoreSize.checked) ignored.push('size'); if(els.ignoreChewer.checked) ignored.push('chewer'); if(els.ignoreAge.checked) ignored.push('age');
        els.giftMeta.textContent = `Showing ${top.length} picks â€¢ ${parts.join(' â€¢ ')}${ignored.length? ' â€¢ ignored: '+ignored.join(', '):''}`;
        els.gifts.innerHTML = top.map(it=>`<div class="gift"><h4>${it.title||'Gift'}</h4><div class="muted">${(it.tag||it.ageTag||'').toString()}</div><div style="margin-top:8px"><a class="link" href="${it.url}" target="_blank" rel="noopener">View</a></div></div>`).join('');
      }catch(e){ els.giftMeta.textContent='Could not load gift ideas.'; }
    }
    $('loadGifts').addEventListener('click', loadGifts);

    // ICS helpers
    const pad=n=>String(n).padStart(2,'0');
    const fmtUTC=d=>d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z';

    // Compute
    function compute(){
      const dobStr=els.dob.value; if(!dobStr){ alert('Please select a birthdate.'); return; }
      const dob=new Date(dobStr), now=new Date(); if(isNaN(dob)||dob>now){ alert('Birthdate is invalid.'); return; }
      const lb=parseInt(els.adultWeight.value,10);

      // Chronological age
      const days=daysBetween(dob, now), years=days/365.2425, yrs=Math.floor(years), months=Math.floor((years%1)*12);
      els.dogAge.textContent = `${yrs}y ${months}m`;

      // Dog-years
      const H=humanEqYears(years, lb, els.smooth.checked); els.humanYears.textContent=H.toFixed(2); const R=slopeFromWeight(lb); els.slopeNote.textContent=`Râ‰ˆ${R.toFixed(2)} (weight-continuous)`;

      // Next dog-year birthday
      const name=els.dogName.value || 'your dog';
      const upcoming=Math.floor(H)+1;
      els.nextHeadline.textContent = `${name} is about to be ${upcoming} years old!`;
      const nbd=nextDogYearDate(dob,H,lb,els.smooth.checked); els.nextBday.textContent=nbd.toDateString(); const dTo=daysBetween(now, nbd); els.nextBdayDelta.textContent = dTo>0? `${dTo} days from now` : '';

      // Profile/notes
      const breedTxt=(els.breed.value||'').trim(); const group=els.breedGroup.value;
      els.profileLine.textContent = `Profile: ${name}${breedTxt?' â€” '+breedTxt:''} â€¢ Group: ${group} â€¢ Weight: ${lb} lb`;
      els.breedNotes.innerHTML = (GROUPS[group]||[]).map(n=>`â€¢ ${n}`).join(' ');

      // Weight/group hint
      let warn=''; if(group.includes('Toy') && lb>30) warn='Breed group "Toy" but weight > 30 lb. Math stays weight-based.'; if((group.includes('Guardian')||group.includes('Working')) && lb<20) warn='Breed group suggests large/giant, but weight < 20 lb. Math stays weight-based.';
      els.sizeWarn.style.display = warn? 'block':'none'; els.sizeWarn.textContent = warn;

      // Celebrate & plan
      confetti(); renderPlan(group, upcoming);

      // If gifts open, refilter
      if(els.gifts.children.length) loadGifts();
    }

    // Buttons
    $('calcBtn').addEventListener('click', compute);
    $('resetBtn').addEventListener('click', ()=>{
      els.dogName.value=''; els.dob.value=''; els.adultWeight.value=55; els.adultWeightVal.textContent='55'; els.chewer.value='Normal';
      els.showEpi.checked=false; els.smooth.checked=true; els.breed.value=''; els.breedGroup.value='Working / Herding';
      els.ignoreAge.checked=els.ignoreSize.checked=els.ignoreChewer.checked=false;
      els.nextHeadline.textContent='â€”'; els.nextBday.textContent='â€”'; els.nextBdayDelta.textContent='';
      els.dogAge.textContent='â€”'; els.humanYears.textContent='â€”'; els.slopeNote.textContent='';
      $('nextPlan').innerHTML=''; $('nextPlanHeading').textContent='Next Birthday Plan';
      els.sizeWarn.style.display='none'; els.gifts.innerHTML=''; els.giftMeta.textContent='';
      renderHero(); updateBreedNotes();
    });
    $('shareBtn').addEventListener('click', ()=>{
      const p=new URLSearchParams({ n:els.dogName.value||'', d:els.dob.value||'', w:els.adultWeight.value, c:els.chewer.value, g:els.breedGroup.value, r:els.breed.value||'', s:els.smooth.checked?1:0, e:els.showEpi.checked?1:0 });
      const url=location.origin+location.pathname+'?'+p.toString();
      navigator.clipboard.writeText(url).then(()=>alert('Shareable link copied.')).catch(()=>alert(url));
    });

    $('addCalBtn').addEventListener('click', ()=>{
      if(!els.nextBday.textContent || els.nextBday.textContent==='â€”'){ alert('Calculate first.'); return; }
      const start=new Date(els.nextBday.textContent), end=new Date(start.getTime()+60*60*1000);
      const name=els.dogName.value||'Your dog';
      const ics=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Barkday//EN
BEGIN:VEVENT
UID:${Date.now()}@barkday
DTSTAMP:${fmtUTC(new Date())}
DTSTART:${fmtUTC(start)}
DTEND:${fmtUTC(end)}
SUMMARY:${name} â€” Next Dog-Year Birthday
END:VEVENT
END:VCALENDAR`;
      const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='barkday.ics'; document.body.appendChild(a); a.click(); a.remove();
    });
    $('remindBtn').addEventListener('click', ()=> alert('Reminder integration placeholder.'));
    $('addYearSeries').addEventListener('click', ()=>{
      if(!els.dob.value){ alert('Calculate first.'); return; }
      const name=els.dogName.value||'Your dog', dob=new Date(els.dob.value), lb=parseInt(els.adultWeight.value,10);
      const now=new Date(), years=daysBetween(dob, now)/365.2425, H=humanEqYears(years, lb, els.smooth.checked);
      let cur=nextDogYearDate(dob, H, lb, els.smooth.checked), dogYears=Math.floor(H)+1;
      let ics='BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Barkday//EN\n';
      for(let i=0;i<3;i++){
        const start=cur, end=new Date(start.getTime()+60*60*1000);
        ics+=`BEGIN:VEVENT\nUID:${Date.now()+Math.random()}@barkday\nDTSTAMP:${fmtUTC(new Date())}\nDTSTART:${fmtUTC(start)}\nDTEND:${fmtUTC(end)}\nSUMMARY:${name} â€” Dog-Year ${dogYears}\nEND:VEVENT\n`;
        dogYears++; cur=nextDogYearDate(dob, dogYears-1, lb, els.smooth.checked);
      }
      ics+='END:VCALENDAR'; const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='barkday_series.ics'; document.body.appendChild(a); a.click(); a.remove();
    });

    // Gifts auto-refilter if visible
    function reloadGiftsIfShown(){ if(els.gifts.children.length>0){ loadGifts(); } }
    ['change'].forEach(ev=>{
      els.adultWeight.addEventListener(ev, reloadGiftsIfShown);
      els.chewer.addEventListener(ev, reloadGiftsIfShown);
      els.ignoreAge.addEventListener(ev, reloadGiftsIfShown);
      els.ignoreSize.addEventListener(ev, reloadGiftsIfShown);
      els.ignoreChewer.addEventListener(ev, reloadGiftsIfShown);
    });

    // QS hydrate (no auto compute)
    (function initFromQS(){
      const q=new URLSearchParams(location.search); if(!q.size) return;
      els.dogName.value=q.get('n')||''; els.dob.value=q.get('d')||''; els.adultWeight.value=q.get('w')||55; els.adultWeightVal.textContent=els.adultWeight.value;
      els.chewer.value=q.get('c')||'Normal'; els.breedGroup.value=q.get('g')||'Working / Herding'; els.breed.value=q.get('r')||'';
      els.smooth.checked=q.get('s')==='1'; els.showEpi.checked=q.get('e')==='1';
      renderHero(); updateBreedNotes();
    })();
  </script>
</body>
</html>
