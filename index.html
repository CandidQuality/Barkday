<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barkdayâ„¢ â€¢ Dog â†’ Human Years</title>
  <style>
    :root{ --bg:#0b0c10; --card:#13151a; --text:#e8ecf1; --muted:#9aa4af; --brand:#4aa3ff; --accent:#6ae3b2; --danger:#ff6b6b; --border:#232734; --shadow:0 6px 24px rgba(0,0,0,.35); }
    :root[data-theme="light"]{ --bg:#f7f8fa; --card:#ffffff; --text:#0f172a; --muted:#475569; --brand:#2563eb; --accent:#059669; --danger:#b91c1c; --border:#e2e8f0; --shadow:0 6px 24px rgba(2,6,23,.08); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:flex-start;justify-content:space-between;margin-bottom:16px}
    .title{display:flex;gap:12px;align-items:center}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#0b0c10}
    .toggle{appearance:none;border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    h1{font-size:22px;margin:0}
    h2{font-size:18px;margin:0 0 8px}
    label{font-weight:600;display:block;margin:14px 0 6px}
    input[type="number"], select, input[type="date"], input[type="text"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg);color:var(--text)}
    input[type="range"]{width:100%}
    .row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    .row > div{flex:1 1 240px;min-width:220px}
    .muted{color:var(--muted);font-size:14px}
    .divider{height:1px;background:var(--border);margin:12px -16px}
    .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
    .pill{border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.05));border-radius:14px;padding:10px 12px}
    .pill h3{margin:0 0 6px;font-size:15px;color:var(--muted);font-weight:600}
    .big{font-size:24px;font-weight:800}
    .pill.primary .big{font-size:26px}
    .headline{font-size:28px;font-weight:900;line-height:1.15;margin:0 0 4px}
    .btn{appearance:none;border:1px solid var(--border);background:var(--brand);color:white;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.secondary{background:transparent;color:var(--text)}
    .cardlist{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .gift{border:1px solid var(--border);border-radius:12px;padding:12px}
    .gift h4{margin:0 0 6px}
    .link{background:none;border:0;color:var(--brand);cursor:pointer;text-decoration:underline;padding:0}
    .hero{margin:4px 0 0 44px}
    .warn{background:rgba(255,107,107,.1);border:1px solid var(--danger);color:var(--danger);padding:8px 10px;border-radius:10px;margin:8px 0}
    .primary{outline:2px solid var(--brand);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 7c0-1.38 1.12-2.5 2.5-2.5S12.5 5.62 12.5 7 11.38 9.5 10 9.5 7.5 8.38 7.5 7Zm6-1c0-1.38 1.12-2.5 2.5-2.5S18.5 4.62 18.5 6 17.38 8.5 16 8.5 13.5 7.38 13.5 6Zm-9 6c0-1.38 1.12-2.5 2.5-2.5S9.5 10.62 9.5 12s-1.12 2.5-2.5 2.5S4.5 13.38 4.5 12Zm14 0c0-1.38 1.12-2.5 2.5-2.5S23.5 10.62 23.5 12s-1.12 2.5-2.5 2.5S18.5 13.38 18.5 12Zm-6.5 4c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4Z"/></svg>
        </div>
        <h1>Barkdayâ„¢</h1>
      </div>
      <button id="themeToggle" class="toggle" type="button" aria-label="Toggle theme">ðŸŒ™ Dark</button>
    </header>
    <p id="heroLine" class="muted hero">Letâ€™s find out together what your precious friendâ€™s birthdays are, so we can celebrate every single one.</p>

    <section class="card">
      <h2>Dog â†’ Human Years</h2>
      <p class="muted">Evidenceâ€‘based calculator using AVMA/AKC milestones (15/9 rule) with a <strong>weightâ€‘continuous slope</strong> after year 2. Optional UCSD DNAâ€‘methylation curve (â‰¥ 1 yr). <em>Calculate/Reset only â€” no autoâ€‘recalc.</em></p>
      <div class="divider"></div>

      <div class="row">
        <div>
          <label for="dogName">Dog name</label>
          <input id="dogName" type="text" placeholder="e.g., Flip" />
        </div>
        <div>
          <label for="dob">Birthdate</label>
          <input id="dob" type="date" />
          <div class="muted">Dog age shown under Results.</div>
        </div>
        <div>
          <label for="adultWeight">Expected adult weight (lb)</label>
          <input id="adultWeight" type="range" min="5" max="200" step="5" value="55" />
          <div class="muted">Aging rate uses <em>5â€‘lb steps</em>. <span id="adultWeightVal">55</span> lb</div>
        </div>
        <div>
          <label for="chewer">Chewer level</label>
          <select id="chewer">
            <option>Gentle</option>
            <option selected>Normal</option>
            <option>Power</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Advanced</label>
          <label class="muted"><input id="showEpigenetic" type="checkbox"/> Show science curve (?) (UCSD DNAâ€‘methylation, â‰¥1 yr)</label>
          <label class="muted"><input id="smoothMilestones" type="checkbox" checked/> Use smooth milestones (blend around 12 & 24 months)</label>
        </div>
        <div>
          <label for="breed">Breed (optional)</label>
          <input id="breed" type="text" placeholder="e.g., Australian Shepherd" />
          <div class="muted">Notes only â€” math stays weightâ€‘based.</div>
        </div>
        <div>
          <label for="breedGroup">Breed group</label>
          <select id="breedGroup">
            <option>Working / Herding</option>
            <option>Sporting</option>
            <option>Hound</option>
            <option>Terrier</option>
            <option>Toy</option>
            <option>Nonâ€‘Sporting</option>
            <option>Guardian</option>
            <option>Companion</option>
            <option>Mixed / Other</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <label class="muted"><input id="ignoreAge" type="checkbox"/> Ignore age filter</label>
        <label class="muted"><input id="ignoreSize" type="checkbox"/> Ignore size filter</label>
        <label class="muted"><input id="ignoreChewer" type="checkbox"/> Ignore chewer filter</label>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="calcBtn" class="btn" type="button">Calculate</button>
        <button id="resetBtn" class="btn secondary" type="button">Reset</button>
        <button id="shareBtn" class="btn secondary" type="button">Share link</button>
      </div>

      <div id="sizeWarn" class="warn" style="display:none"></div>

      <div class="divider"></div>

      <h2>Results</h2>
      <div class="kpi">
        <div class="pill primary"><div class="headline" id="nextHeadline">â€”</div><div class="big" id="nextBday">â€”</div><div class="muted" id="nextBdayDelta"></div></div>
        <div class="pill"><h3>Dog age today</h3><div class="big" id="dogAge">â€”</div></div>
        <div class="pill"><h3>Humanâ€‘years estimate</h3><div class="big" id="humanYears">â€”</div><div class="muted" id="slopeNote"></div></div>
      </div>
      <p id="profileLine" class="muted" style="margin:8px 0 0">â€”</p>
      <div id="breedNotes" class="muted" style="margin:6px 0 0"></div>

      <div class="row" style="margin-top:10px">
        <button id="addCalBtn" class="btn" type="button">Add to calendar (birthday)</button>
        <button id="remindBtn" class="btn secondary" type="button">Add 1â€‘week reminder</button>
        <button id="addYearSeries" class="btn secondary" type="button">Add next 3 dogâ€‘year birthdays</button>
      </div>

      <div id="epi" class="muted" style="margin-top:10px"></div>

      <div class="divider"></div>

      <h2>Gift ideas</h2>
      <button id="loadGifts" class="btn secondary" type="button">Load gift ideas</button>
      <div id="giftMeta" class="muted" style="margin:8px 0"></div>
      <div id="gifts" class="cardlist"></div>
    </section>
  </div>

  <script>
    // THEME
    const root = document.documentElement; const toggleBtn = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('barkday-theme') || 'dark';
    root.setAttribute('data-theme', savedTheme === 'light' ? 'light' : 'dark');
    toggleBtn.textContent = savedTheme === 'light' ? 'ðŸŒ™ Dark' : 'â˜€ï¸ Light';
    toggleBtn.addEventListener('click', () => { const now = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light'; root.setAttribute('data-theme', now); localStorage.setItem('barkday-theme', now); toggleBtn.textContent = now === 'light' ? 'ðŸŒ™ Dark' : 'â˜€ï¸ Light'; });

    // CONSTANTS
    const GIFT_FEED_URL = 'https://raw.githubusercontent.com/CandidQuality/dog-birthday-feed/main/dog-gifts.json'; // hidden from UI

    // Elements$1renderHero();

    // --- Live breed/group notes (display-only)
    function updateBreedNotes(){
      const name = els.dogName.value || 'your dog';
      const breedTxt = (els.breed.value||'').trim();
      const group = els.breedGroup.value;
      const lb = parseInt(els.adultWeight.value,10) || 55;
      els.profileLine.textContent = `Profile: ${name}${breedTxt?` â€” ${breedTxt}`:''} â€¢ Group: ${group} â€¢ Weight: ${lb} lb`;
      const notes = GROUPS[group]||[]; els.breedNotes.innerHTML = notes.map(n=>`â€¢ ${n}`).join(' ');
    }
    ['input','change'].forEach(ev=>{
      els.breed.addEventListener(ev, updateBreedNotes);
      els.breedGroup.addEventListener(ev, updateBreedNotes);
      els.dogName.addEventListener(ev, updateBreedNotes);
    });
    updateBreedNotes();

    // Slider label (5â€‘lb steps)$1

    // If gifts are showing, re-filter when relevant controls change
    function reloadGiftsIfShown(){ if(els.gifts && els.gifts.children && els.gifts.children.length>0){ loadGifts(); } }
    els.adultWeight.addEventListener('change', reloadGiftsIfShown);
    els.chewer.addEventListener('change', reloadGiftsIfShown);
    els.ignoreAge.addEventListener('change', reloadGiftsIfShown);
    els.ignoreSize.addEventListener('change', reloadGiftsIfShown);
    els.ignoreChewer.addEventListener('change', reloadGiftsIfShown);

    // Helpers
    function daysBetween(a,b){ return Math.floor((b - a) / (24*60*60*1000)); }
    function clamp(n,min,max){ return Math.min(Math.max(n,min),max); }

    // Weightâ€‘continuous slope 5â†’7 (soft 7.2 at 200 lb)
    function slopeFromWeight(lb){ const w = clamp(lb, 5, 200); if(w <= 20) return 5; if(w <= 50) return 5 + (w-20)*(1/30); if(w <= 90) return 6 + (w-50)*(1/40); return 7 + (w-90)*(0.2/110); }
    function smoothBlend(x, center, width){ const t = clamp((x - (center - width/2)) / width, 0, 1); return t*t*(3 - 2*t); }
    function humanEqYears(tYears, lb, useSmooth){ const R = slopeFromWeight(lb); if(!useSmooth){ if(tYears <= 1) return 15*tYears; if(tYears <= 2) return 15 + 9*(tYears-1); return 24 + R*(tYears-2); } const f1 = smoothBlend(tYears, 1, 0.25); const slope12 = 15 + f1*(9-15); if(tYears <= 2){ const part0 = Math.min(tYears,1)*15; const part1 = tYears>1 ? (tYears-1)*slope12 : 0; return part0 + part1; } const f2 = smoothBlend(tYears, 2, 0.5); const slopePost = 9 + f2*(R-9); const upTo2 = humanEqYears(2, lb, true); return upTo2 + (tYears-2)*slopePost; }
    function nextDogYearDate(dob, currentHumanEq, lb, useSmooth){ const target = Math.floor(currentHumanEq) + 1; const now = new Date(); const yearsNow = daysBetween(dob, now) / 365.2425; let lo = yearsNow, hi = yearsNow + 5; for(let i=0;i<40;i++){ const mid=(lo+hi)/2; const h=humanEqYears(mid, lb, useSmooth); if(h>=target) hi=mid; else lo=mid; } const t=(lo+hi)/2; return new Date(dob.getTime() + t*365.2425*24*60*60*1000); }

    // Breed notes (display only)
    const GROUPS = {
      'Working / Herding':['High drive: daily jobs/puzzles (herding games, scentwork, obedience chains).','Mental fatigue matters as much as physical; enrichment like snuffle mats and hideâ€‘andâ€‘seek.','Prevent underâ€‘stimulation â†’ boredom behaviors.'],
      'Sporting':['Endurance + retrieve instincts: structured fetch, dock diving, field games.','Watch weight gain; mealâ€‘prep measured portions.'],
      'Hound':['Scent/sight tracking: longâ€‘line scent walks, lure coursing where safe.','Strong recall training with highâ€‘value rewards.'],
      'Terrier':['Channel hunt drive: dig boxes, flirt poles, controlled tug.'],
      'Toy':['Fragility: lowâ€‘impact play; dental care is critical.','Mind thermoregulation (cold/heat).'],
      'Nonâ€‘Sporting':['Varied needs; tailor enrichment to individual energy and health.'],
      'Guardian':['Impulse control & neutrality training.','Joint support and moderated growth for large/giant frames.'],
      'Companion':['Humanâ€‘bonded: reinforce calm independence to reduce separation stress.'],
      'Mixed / Other':['Profile by observed drive (retrieve, scent, herd) rather than labels.']
    };

    // Confetti (multiâ€‘color)
    function confetti(durationMs=1700){
      const canvas = document.createElement('canvas'); canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.pointerEvents='none'; canvas.width=innerWidth; canvas.height=innerHeight; document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d'); const colors=['#4aa3ff','#6ae3b2','#ffd166','#ff6b6b','#a78bfa']; const N=160;
      const parts = Array.from({length:N},()=>({x:Math.random()*canvas.width,y:-20-Math.random()*40,vx:(Math.random()-.5)*4,vy:2+Math.random()*3,g:0.05+Math.random()*0.05,s:4+Math.random()*4,c:colors[Math.floor(Math.random()*colors.length)],r:Math.random()*Math.PI}));
      let start=null; function tick(ts){ if(!start) start=ts; const t=ts-start; ctx.clearRect(0,0,canvas.width,canvas.height); for(const p of parts){ p.x+=p.vx; p.y+=p.vy; p.vy+=p.g; p.r+=0.05; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r); ctx.fillStyle=p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); ctx.restore(); } if(t<durationMs) requestAnimationFrame(tick); else canvas.remove(); } requestAnimationFrame(tick);
    }

    // ICS helpers
    function fmtUTC(d){ const pad=n=>String(n).padStart(2,'0'); return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z'; }
    function icsEvent(summary, start, end){ return `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Barkday//EN\nBEGIN:VEVENT\nUID:${Date.now()}@barkday\nDTSTAMP:${fmtUTC(new Date())}\nDTSTART:${fmtUTC(start)}\nDTEND:${fmtUTC(end)}\nSUMMARY:${summary}\nEND:VEVENT\nEND:VCALENDAR`; }
    function downloadICS(name, ics){ const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; document.body.appendChild(a); a.click(); a.remove(); }

    // Gift loader (URL hidden)$1

    // CALCULATE
    const updateWeightLabel = ()=> els.adultWeightVal.textContent = els.adultWeight.value; updateWeightLabel();

    function compute(){
      const dobStr = els.dob.value; if(!dobStr){ alert('Please select a birthdate.'); return; }
      const dob = new Date(dobStr); const now = new Date(); if(isNaN(dob.getTime()) || dob>now){ alert('Birthdate is invalid.'); return; }
      const lb = parseInt(els.adultWeight.value,10);

      // Age now
      const days = daysBetween(dob, now); const years = days/365.2425; const yrs=Math.floor(years); const months=Math.floor((years%1)*12);
      els.dogAge.textContent = `${yrs}y ${months}m`;

      // Humanâ€‘equivalent
      const H = humanEqYears(years, lb, els.smooth.checked); els.humanYears.textContent = H.toFixed(2); const R = slopeFromWeight(lb); els.slopeNote.textContent = `Râ‰ˆ${R.toFixed(2)} (weightâ€‘continuous)`;

      // Next dogâ€‘year (primary)
      const name = els.dogName.value || 'your dog';
      const upcoming = Math.floor(H)+1; els.nextHeadline.textContent = `${name} is about to be ${upcoming} years old!`;
      const nbd = nextDogYearDate(dob, H, lb, els.smooth.checked); els.nextBday.textContent = nbd.toDateString(); const daysTo = daysBetween(now, nbd); els.nextBdayDelta.textContent = daysTo>0? `${daysTo} days from now` : '';

      // Profile & notes
      const breedTxt=(els.breed.value||'').trim(); const group=els.breedGroup.value; els.profileLine.textContent = `Profile: ${name}${breedTxt?` â€” ${breedTxt}`:''} â€¢ Group: ${group} â€¢ Weight: ${lb} lb`;
      const notes = GROUPS[group]||[]; els.breedNotes.innerHTML = notes.map(n=>`â€¢ ${n}`).join(' ');

      // Gentle mismatch warning
      let warn=''; if(group.includes('Toy') && lb>30) warn='Breed group "Toy" but weight > 30 lb. Math stays weightâ€‘based.'; if((group.includes('Guardian')||group.includes('Working')) && lb<20) warn='Breed group suggests large/giant, but weight < 20 lb. Math stays weightâ€‘based.'; els.sizeWarn.style.display = warn? 'block':'none'; els.sizeWarn.textContent = warn;

      // Gift meta
      els.giftMeta.textContent = `Gift picks for ${name} â€” by weight ${lb} lb${breedTxt?`, ${breedTxt}`:''}`;

      // Celebrate
      els.nextBday.scrollIntoView({behavior:'smooth', block:'center'}); confetti();

      // If user already opened gifts once, keep them in sync after a new calculation
      reloadGiftsIfShown();
    }); confetti();
    }

    // EVENTS
    els.calcBtn.addEventListener('click', compute);
    els.resetBtn.addEventListener('click', ()=>{ els.dogName.value=''; els.dob.value=''; els.adultWeight.value=55; updateWeightLabel(); els.chewer.value='Normal'; els.showEpi.checked=false; els.smooth.checked=true; els.breed.value=''; els.breedGroup.value='Working / Herding'; els.ignoreAge.checked=els.ignoreSize.checked=els.ignoreChewer.checked=false; els.nextHeadline.textContent='â€”'; els.nextBday.textContent='â€”'; els.nextBdayDelta.textContent=''; els.dogAge.textContent='â€”'; els.humanYears.textContent='â€”'; els.slopeNote.textContent=''; els.epi.textContent=''; els.gifts.innerHTML=''; els.giftMeta.textContent=''; els.sizeWarn.style.display='none'; renderHero(); });
    els.shareBtn.addEventListener('click', ()=>{ const p=new URLSearchParams({ n:els.dogName.value||'', d:els.dob.value||'', w:els.adultWeight.value, c:els.chewer.value, g:els.breedGroup.value, r:els.breed.value||'', s:els.smooth.checked?1:0, e:els.showEpi.checked?1:0 }); const url=location.origin+location.pathname+'?'+p.toString(); navigator.clipboard.writeText(url).then(()=>alert('Shareable link copied.')).catch(()=>alert(url)); });

    // ICS buttons
    els.addCal.addEventListener('click', ()=>{ if(!els.nextBday.textContent || els.nextBday.textContent==='â€”'){ alert('Calculate first.'); return; } const start=new Date(els.nextBday.textContent); const end=new Date(start.getTime()+60*60*1000); const name=els.dogName.value||'Your dog'; downloadICS('barkday.ics', icsEvent(`${name} â€” Next Dogâ€‘Year Birthday`, start, end)); });
    els.remind.addEventListener('click', ()=> alert('Reminder integration placeholder: add 1â€‘week reminder.'));
    els.addYearSeries.addEventListener('click', ()=>{ if(!els.dob.value){ alert('Calculate first.'); return; } const name=els.dogName.value||'Your dog'; const dob=new Date(els.dob.value); const lb=parseInt(els.adultWeight.value,10); const now=new Date(); const years=daysBetween(dob, now)/365.2425; const H=humanEqYears(years, lb, els.smooth.checked); let cur=nextDogYearDate(dob, H, lb, els.smooth.checked); let human=Math.floor(H)+1; let ics='BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Barkday//EN\n'; for(let i=0;i<3;i++){ const start=cur; const end=new Date(start.getTime()+60*60*1000); ics+=`BEGIN:VEVENT\nUID:${Date.now()+Math.random()}@barkday\nDTSTAMP:${fmtUTC(new Date())}\nDTSTART:${fmtUTC(start)}\nDTEND:${fmtUTC(end)}\nSUMMARY:${name} â€” Dogâ€‘Year ${human}\nEND:VEVENT\n`; human++; cur=nextDogYearDate(dob, human-1, lb, els.smooth.checked); } ics+='END:VCALENDAR'; downloadICS('barkday_series.ics', ics); });

    // Gift loader
    els.loadGifts.addEventListener('click', loadGifts);

    // Hydrate from QS (no auto compute)
    (function initFromQS(){ const q=new URLSearchParams(location.search); if(q.size){ els.dogName.value=q.get('n')||''; els.dob.value=q.get('d')||''; els.adultWeight.value=q.get('w')||55; els.adultWeightVal.textContent=els.adultWeight.value; els.chewer.value=q.get('c')||'Normal'; els.breedGroup.value=q.get('g')||'Working / Herding'; els.breed.value=q.get('r')||''; els.smooth.checked=q.get('s')==='1'; els.showEpi.checked=q.get('e')==='1'; renderHero(); } })();
  </script>
</body>
</html>
